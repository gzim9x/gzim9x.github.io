!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"Chart",function(){return s});class s{constructor(t,e={},i={}){this.data=this.prepareData(i),this.preprocess(),this.chart=document.getElementById(t),this.title=this.createTitleBlock(this.chart,"Followers"),this.canvases={data:{},points:{},slider:{}},[this.canvases.slider.canvas,this.canvases.slider.context]=this.createSlider(this.chart),[this.canvases.data.canvas,this.canvases.data.context]=this.createDataBlock(this.chart),this.renderAxis(1),this.createLegendBlock(this.chart,this.data),this.createPointsBlock(this.chart),this.createLegendsPopup(this.chart,this.data),this.createThemeChecker(this.chart),this.resize(1),window.addEventListener("resize",this.resize.bind(this),!1)}preprocess(){this.mode="day",this.stepX=100/(this.data.len-1),this.axisCountStepsY=7,this.viewportControlsWidth=7,this.viewportLeft=0,this.scaleX=1,this.nearestIndex=null,this.nearestX=0,this.nearestY={},this.mouseOffsetX=0,this.axisVerticalStep=0}prepareData(t){const e={len:0,axis:{},lines:{}};return Object.keys(t.types).forEach(i=>{if("x"===t.types[i])for(let s of t.columns)s[0]===i&&(e.axis[i]={times:s.slice(1)},e.axis[i].dates=e.axis[i].times.map(t=>this.getMonthDay(t)));else if("line"===t.types[i])for(let s of t.columns)s[0]===i&&(e.len||(e.len=s.length-1),e.lines[i]={hide:!1,color:t.colors[i],name:t.names[i],data:s.slice(1)})}),e}createTitleBlock(t,e){return this.createNode(t,"span","chart__title",e)}createDataBlock(t){return this.createCanvas(t,"chart__data")}createSlider(t){const e=this.createNode(t,"div","chart__slider"),i=this.createNode(e,"div","chart__slider-wrapper");this.viewport=this.createNode(i,"div","chart__viewport"),this.viewportControl=this.createNode(this.viewport,"span","chart__viewport-control"),this.viewportControl.onmousedown=(t=>{t.stopPropagation(),this.viewportX=t.clientX,t.offsetX<this.viewportControlsWidth?this.viewportDirection=1:t.offsetX>this.viewportWidth-this.viewportControlsWidth?this.viewportDirection=2:this.viewportDirection=3,document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)});const s=t=>{let e=t.clientX-this.viewportX;if(e){switch((2===this.viewportDirection||3===this.viewportDirection)&&e>0&&this.viewportLeft+this.viewportWidth+e>this.canvases.data.width&&(e=this.canvases.data.width-this.viewportWidth-this.viewportLeft),(1===this.viewportDirection||3===this.viewportDirection)&&e<0&&this.viewportLeft+e<0&&(e=-this.viewportLeft),this.viewportDirection){case 1:this.viewportWidth-=e,this.viewportLeft+=e;break;case 2:this.viewportWidth+=e;break;default:this.viewportLeft+=e}this.viewportX=t.clientX,r(this.viewportWidth,this.viewportLeft),this.scaleX=this.canvases.data.width/this.viewportWidth,this.renderData(this.canvases.data),this.renderAxis()}},a=()=>{this.viewportX=this.viewportDirection=0,document.removeEventListener("mouseup",a),document.removeEventListener("mousemove",s)},r=(t,e)=>{this.viewport.style.width=`${t}px`,this.viewport.style.left=`${e}px`},[o,h]=this.createCanvas(t,"chart__slider-data"),n=o.getBoundingClientRect();return this.viewportWidth=Math.round(30*n.width/100),this.viewportLeft=n.width-this.viewportWidth,r(this.viewportWidth,this.viewportLeft),this.scaleX=n.width/this.viewportWidth,[o,h]}createPointsBlock(t){const e=this.canvases.points;[e.canvas,e.context]=this.createCanvas(t,"chart-active"),e.canvas.onmouseover=(t=>{if(t.stopPropagation(),!this.getActiveDataKeys().length)return;this.legendsPopup.style.display="block";const i=t=>{t.stopPropagation(),document.removeEventListener("mousemove",s),e.canvas.removeEventListener("mouseout",i),this.clearCanvas(e),this.nearestIndex=null,this.nearestY={},this.legendsPopup.style.display="none"},s=t=>{t.stopPropagation(),this.mouseOffsetX=t.offsetX;const i=this.getNearestIndex();this.nearestIndex!==i&&(this.nearestIndex=i,this.renderData(this.canvases.data),this.renderPoints(e))};e.canvas.addEventListener("mouseout",i),document.addEventListener("mousemove",s)})}getNearestIndex(){return Math.round((this.mouseOffsetX+this.viewportLeft*this.scaleX)*(this.data.len-1)/(this.canvases.data.width*this.scaleX))}createLegendBlock(t,e){const i=document.createElement("div");i.className="chart__legends",Object.keys(e.lines).forEach(t=>{const s=this.createNode(i,"span","chart__legends-name",e.lines[t].name),a=this.createNode(s,"span","chart__legends-checkbox");a.style.borderColor=e.lines[t].color;const r=this.createNode(a,"span","chart__legends-checker","âœ”");r.style.background=e.lines[t].color,a.onclick=(i=>{e.lines[t].hide=!e.lines[t].hide,r.className=e.lines[t].hide?"chart__legends-checker off":"chart__legends-checker",this.resize(1)})}),t.appendChild(i)}createLegendsPopup(t,e){this.legendsPopup=document.createElement("div"),this.legendsPopup.className="chart__legends-popup",this.legendsPopupTitle=this.createNode(this.legendsPopup,"span","chart__legends-popup-title"),this.legendsPopupValues=this.createNode(this.legendsPopup,"span","chart__legends-popup-values"),t.appendChild(this.legendsPopup)}createThemeChecker(t){const e=this.createNode(this.chart,"span","chart__theme-checker","Switch to Night mode");e.onclick=(t=>{switch(this.mode="day"===this.mode?"night":"day",this.mode){case"day":this.chart.className="chart",this.clearNode(e),e.appendChild(document.createTextNode("Switch to Night mode"));break;case"night":this.chart.className="chart night",this.clearNode(e),e.appendChild(document.createTextNode("Switch to Day mode"))}})}resize(t=0){this.dpr=window.devicePixelRatio||1,Object.keys(this.canvases).forEach(t=>this.hdpiCanvas(this.canvases[t],this.dpr)),t&&Object.keys(this.canvases).forEach(t=>{this.canvases[t].context.translate(0,this.canvases[t].canvas.height),this.canvases[t].context.scale(this.dpr,-this.dpr)}),this.render(),this.renderPoints(this.canvases.points),this.renderAxis()}hdpiCanvas(t,e=1){const{width:i,height:s}=t.canvas.getBoundingClientRect();t.width=i,t.height=s,t.canvas.width=i*e,t.canvas.height=s*e}render(){this.renderData(this.canvases.data),this.renderData(this.canvases.slider,2,1,0)}renderAxis(t=0){this.renderAxisVertical(t),this.renderAxisHorisontal(t)}renderAxisVertical(t=0){if(t)return this.axisVertical=this.createNode(this.chart,"div","chart__axis-vertical"),this.axisVerticalWrapper=this.createNode(this.axisVertical,"div","chart__axis-vertical-wrapper"),this.axisVerticalItems=this.createNode(this.axisVerticalWrapper,"div","chart__axis-vertical-items"),void this.createNode(this.axisVerticalWrapper,"div","chart__axis-vertical-item-zero",0);const e=(t,e,i)=>{let[s,a,r,o]=e;requestAnimationFrame(function e(){t.style.opacity=s,t.style.marginTop=`${a}px`,r>0&&s<1||r<0&&s>0?(s+=r,a+=o,requestAnimationFrame(e)):"function"==typeof i&&i()})},i=()=>{this.axisVerticalStep=this.roundStepY(this.viewportMaxY/this.axisCountStepsY,5);for(let t=6;t>=1;t--)this.createNode(this.axisVerticalItems,"div","chart__axis-vertical-item",this.axisVerticalStep*t)};if(!this.getActiveDataKeys().length)return this.clearNode(this.axisVerticalItems),void(this.axisVerticalForceRenderFlag=1);this.axisVerticalStep=this.roundStepY(this.viewportMaxY/this.axisCountStepsY,5);const s=this.axisVerticalStep*this.axisCountStepsY;(void 0===this.newMaxVerticalY||this.newMaxVerticalY!==s||this.axisVerticalForceRenderFlag)&&(this.newMaxVerticalY=s,this.axisVerticalForceRenderFlag=0,void 0===this.viewportMaxY_old&&(this.viewportMaxY_old=this.viewportMaxY),this.viewportMaxY<this.viewportMaxY_old?(this.clearNode(this.axisVerticalItems),((t,i)=>e(t,[1,0,-.05,1],i))(this.axisVerticalItems,()=>{this.clearNode(this.axisVerticalItems),i(),((t,i)=>e(t,[0,-10,.05,1],i))(this.axisVerticalItems)})):this.viewportMaxY>this.viewportMaxY_old?(this.clearNode(this.axisVerticalItems),i(),((t,i)=>e(t,[1,0,-.05,-1],i))(this.axisVerticalItems,()=>{this.clearNode(this.axisVerticalItems),i(),((t,i)=>e(t,[0,20,.05,-1],i))(this.axisVerticalItems)})):(this.clearNode(this.axisVerticalItems),i()),this.viewportMaxY_old=this.viewportMaxY)}renderAxisHorisontal(t=0){t&&(this.axisHorisontal=this.createNode(this.chart,"div","chart__axis-horisontal"),this.axisHorisontalWrapper=this.createNode(this.axisHorisontal,"div","chart__axis-horisontal-wrapper"),this.axisHorisontalNodes={},this.axisFadeProgress={});const e=t=>{this.removeNode(this.axisHorisontalNodes[t]),delete this.axisHorisontalNodes[t],void 0!==this.axisFadeProgress[t]&&delete this.axisFadeProgress[t]},i=t=>{void 0===this.axisFadeProgress[t]&&(this.axisFadeProgress[t]=1,this.fadeOut(this.axisHorisontalNodes[t],()=>{delete this.axisFadeProgress[t],e(t)}))};let s=1;for(;this.canvases.data.width*s/(this.viewportToIndex-this.viewportFromIndex)<100;)s*=2;for(let t=0,a=this.data.len,r=0;t<a;t++)if(r++,0===t||t===this.data.len-1||r===s?(t>=this.viewportFromIndex&&t<=this.viewportToIndex?void 0===this.axisHorisontalNodes[t]&&(this.axisHorisontalNodes[t]=this.createNode(this.axisHorisontalWrapper,"span","chart__axis-horisontal-item",this.data.axis.x.dates[t],{opacity:0}),this.fadeIn(this.axisHorisontalNodes[t])):void 0!==this.axisHorisontalNodes[t]&&e(t),r=0):void 0!==this.axisHorisontalNodes[t]&&i(t),void 0!==this.axisHorisontalNodes[t])if(0===t)this.axisHorisontalNodes[t].style.left="1.3em";else if(t===this.data.len-1)this.axisHorisontalNodes[t].style.left=`calc(${this.canvases.data.width-this.axisHorisontalNodes[t].style.width}px - 2em)`;else{const e=this.perToPix(t*this.stepX*this.scaleX,this.canvases.data.width)-this.viewportLeft*this.scaleX;this.axisHorisontalNodes[t].style.left=`${e}px`,0===this.viewportFromIndex&&e<100||this.viewportToIndex===this.data.len-1&&e>this.canvases.data.width-100?this.axisHorisontalNodes[t].style.display="none":this.axisHorisontalNodes[t].style.display="inline-block"}}renderData(t,e=3,i=1,s=1){i&&this.clearCanvas(t);const a=t.context;let r;a.lineWidth=e,a.lineJoin="round",this.viewportMaxY=this.getMaxYByViewport(),r=s?99*this.viewportMaxY/this.newMaxVerticalY/this.viewportMaxY:95/this.getMaxY(),this.getActiveDataKeys().forEach(e=>{s&&(a.save(),a.translate(-this.viewportLeft*this.scaleX,0),a.scale(this.scaleX,1)),a.beginPath();for(let i=0,s=this.data.lines[e].data.length;i<s;i++){let s=[this.perToPix(i*this.stepX,t.width),this.perToPix(this.data.lines[e].data[i]*r,t.height)];this.nearestIndex===i&&([this.nearestX,this.nearestY[e]]=s),i<1?a.moveTo(...s):a.lineTo(...s)}s&&a.restore(),a.strokeStyle=this.data.lines[e].color,a.stroke()})}renderPoints(t){if(null===this.nearestIndex)return;if(!Object.keys(this.nearestY).length)return;const e=t.context;this.clearCanvas(t);const i=this.nearestX*this.scaleX-this.viewportLeft*this.scaleX;e.beginPath(),e.moveTo(i,0),e.lineTo(i,t.height),e.lineWidth=.7,e.strokeStyle="day"===this.mode?"#aaa":"#313d4d",e.stroke(),this.getActiveDataKeys().forEach(t=>{this.nearestY[t]&&(e.beginPath(),e.arc(i,this.nearestY[t],6,0,2*Math.PI,!1),e.fillStyle="day"===this.mode?"#ffffff":"#242f3e",e.fill(),e.lineWidth=3,e.strokeStyle=this.data.lines[t].color,e.stroke())}),this.renderActiveLegends()}renderActiveLegends(){this.clearNode(this.legendsPopupTitle);const t=this.data.axis.x.times[this.nearestIndex];this.legendsPopupTitle.appendChild(document.createTextNode(`${this.getWeekDay(t)}, ${this.data.axis.x.dates[this.nearestIndex]}`));const e=Object.keys(this.data.lines).reduce((t,e)=>this.data.lines[e].hide?t:t+1,0);if(!e)return;let i=80*e;i<140&&(i=140),this.legendsPopup.style.width=`${i}px`;let s=this.mouseOffsetX;this.canvases.data.width-this.mouseOffsetX<i&&(s=this.canvases.data.width-i),this.legendsPopup.style.left=`${s}px`,this.legendsPopup.style.top="30px",this.clearNode(this.legendsPopupValues),this.getActiveDataKeys().forEach(t=>{const i=this.createNode(this.legendsPopupValues,"span","chart__legends-popup-values-block");i.style.width=`${100/e}%`,this.createNode(i,"span","chart__legends-popup-value",this.data.lines[t].data[this.nearestIndex]).style.color=this.data.lines[t].color,this.createNode(i,"span","chart__legends-popup-name",this.data.lines[t].name).style.color=this.data.lines[t].color})}getMaxYByViewport(){return this.viewportFromIndex=Math.floor(this.viewportLeft*(this.data.len-1)/this.canvases.data.width),this.viewportToIndex=Math.ceil((this.viewportLeft+this.viewportWidth)*(this.data.len-1)/this.canvases.data.width),this.getMaxY(this.viewportFromIndex,this.viewportToIndex)}getMaxY(t=0,e=this.data.len){return this.maxByVec(this.getActiveDataKeys().reduce((i,s)=>(i.push(...this.data.lines[s].data.slice(t,e)),i),[]))}maxByVec(t){return Math.max(...t)}roundStepY(t,e){return Math.ceil(t/e)*e}perToPix(t=0,e=0){return.5+t*e/100|0}getActiveDataKeys(){return Object.keys(this.data.lines).filter(t=>!this.data.lines[t].hide)}createCanvas(t,e){const i=this.createNode(t,"canvas",e);return[i,i.getContext("2d")]}createNode(t,e="",i="",s,a){const r=document.createElement(e);return r.className=i,void 0!==s&&r.appendChild(document.createTextNode(s)),void 0!==a&&Object.keys(a).forEach(t=>r.style[t]=a[t]),t.appendChild(r),r}clearNode(t){try{for(;t.firstChild;)t.removeChild(t.firstChild)}catch(t){}}removeNode(t){try{t.parentElement.removeChild(t)}catch(t){}}fadeOut(t,e){let i=1;requestAnimationFrame(function s(){t.style.opacity=i,i>0?(i-=.05,requestAnimationFrame(s)):"function"==typeof e&&e()})}fadeIn(t,e){let i=0;requestAnimationFrame(function s(){t.style.opacity=i,i<1?(i+=.2,requestAnimationFrame(s)):"function"==typeof e&&e()})}clearCanvas(t){t.context.clearRect(0,0,t.width,t.height)}getMonthDay(t){return this.getDateString(t,4,10)}getWeekDay(t){return this.getDateString(t,0,3)}getDateString(t,e,i){return new Date(1e3*t).toString().slice(e,i)}round(t){return.5+t|0}}new s("chart0",{},window.data[0]),new s("chart1",{},window.data[1]),new s("chart2",{},window.data[2]),new s("chart3",{},window.data[3]),new s("chart4",{},window.data[4])}]);